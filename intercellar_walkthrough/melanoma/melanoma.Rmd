---
title: "Walkthrough of melanoma cell-cell communication analysis with InterCellar"
author: Marta Interlandi (marta.interlandi@uni-muenster.de)
output: github_document
---


```{r, echo=FALSE, out.width='20%', fig.align='center'}
knitr::include_graphics(path = "screenshots/logo_lowres.png")
```

## Introduction

In this walkthrough, we show how the results presented in our paper were collected, with regards to the melanoma dataset from [Tirosh et al.](https://www.science.org/doi/10.1126/science.aad0501). All results were generated by [InterCellar v2.0.0](http://www.bioconductor.org/packages/release/bioc/html/InterCellar.html) (Bioconductor release 3.14).

## Input data

We used [CellChat](https://github.com/sqjin/CellChat) to compute predicted cell-cell interactions (CCI). You can find this CellChat-CCI data in folder `cellchat_comparison/melanoma/cellchat_melanoma_interactions.csv`. For details on how we preprocessed the melanoma scRNA-seq data, please check out folder `input_data/melanoma`.

## Upload data

Once `InterCellar` is running, we navigate to the **Upload** module under **1.Data** to upload our input data and start the analysis. We use panel *From supported tools*, where we can select `CellChat` as input method and, after filling out metadata which will be then used by `InterCellar` (output folder, CCI data ID and output folder tag), we upload the .csv file by clicking on `GO!`.

```{r, echo=FALSE, out.width='100%', fig.align='center'}
knitr::include_graphics(path = "screenshots/upload_mela.png")
```


## Data exploration: Universes

As first step in our analysis we perform data exploration by navigating to the three **Universes**, starting with the **cluster-verse**. 

```{r, echo=FALSE, out.width='100%', fig.align='center'}
knitr::include_graphics(path = "screenshots/cv_net_mela.png")
```

Next, we explore the **gene-verse**: clicking on `Filter!` will compute the **Table** shown below:

```{r, echo=FALSE, out.width='100%', fig.align='center'}
knitr::include_graphics(path = "screenshots/gv_tab_mela.png")
```


We can click on int-pairs of interest, shown in this **Table**, to trigger the creation of a **Dot plot**:

```{r, echo=FALSE, out.width='100%', fig.align='center'}
knitr::include_graphics(path = "screenshots/gv_dot_mela.png")
```

Lastly, we continue with the **function-verse**, where we perform the functional annotation selecting all data source available. The results of the annotation are then shown in **Table**:

```{r, echo=FALSE, out.width='100%', fig.align='center'}
knitr::include_graphics(path = "screenshots/fv_tab_mela.png")
```

A second table is provided in **Ranking**, where annotated functional terms are ranked by the number of enriched int-pairs:

```{r, echo=FALSE, out.width='100%', fig.align='center'}
knitr::include_graphics(path = "screenshots/fv_rank_mela.png")
```

By clicking on a functional term of interest in this **Ranking**, the corresponding **Sunburst plot** is generated:

```{r, echo=FALSE, out.width='100%', fig.align='center'}
knitr::include_graphics(path = "screenshots/fv_sun_mela.png")
```

## Int-pair modules analysis

We continue our analysis with the **Int-pair Modules** panel, which can be found under **3. Data-driven analysis**. As first step, we choose *Viewpoint cluster* and *Flow* as malignant cells and directed-outgoing:

```{r, echo=FALSE, out.width='100%', fig.align='center'}
knitr::include_graphics(path = "screenshots/ip_choice_mela.png")
```

`InterCellar` computes int-pair modules and displays them in a **dendrogram** and a **UMAP**. The number of modules is automatically chosen by `InterCellar` from the *Elbow Plot*, but can be redefined by the user: here we increase the number from 7 to 9, to gain more specificity on modules composed of many int-pairs.

```{r, echo=FALSE, out.width='100%', fig.align='center'}
knitr::include_graphics(path = "screenshots/ip_def_mela.png")
```

Each int-pair module can be visualized in a **Circle Plot**. We choose module #8 and color links by scaled interaction score:

```{r, echo=FALSE, out.width='100%', fig.align='center'}
knitr::include_graphics(path = "screenshots/ip_circle8_mela.png")
```

Finally, we can investigate significant functional terms associated to each module in the following **Table**. In particular, we manually selected relevant terms from these tables and annotated the UMAP presented in Fig. 3a of our manuscript. 

```{r, echo=FALSE, out.width='100%', fig.align='center'}
knitr::include_graphics(path = "screenshots/ip_func_tab_1_mela.png")
```

